const canvas = document.getElementById("mapCanvas");
const ctx = canvas.getContext("2d");
const tileSize = 20; // Größe eines Tiles
const rows = canvas.height / tileSize;
const cols = canvas.width / tileSize;

// Map-Array (0 = leer, 1 = Benutzerzeichnung)
let mapArray = Array.from({ length: rows }, () => Array(cols).fill(0));

// Perlin-Noise-Funktion (vereinfachte Implementierung)
function perlinNoise(x, y) {
    return (Math.sin(x * 0.1) + Math.cos(y * 0.1)) * 0.5 + 0.5;
}

// Karte zeichnen
function drawMap() {
    for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
            let value = mapArray[row][col];
            if (value === 1) {
                ctx.fillStyle = "brown"; // Benutzerzeichnung
            } else if (value > 0) {
                let intensity = Math.floor(value * 255);
                ctx.fillStyle = `rgb(0, ${intensity}, 0)`; // Grün für Noise
            } else {
                ctx.fillStyle = "white"; // Leere Tiles
            }
            ctx.fillRect(col * tileSize, row * tileSize, tileSize, tileSize);
        }
    }
}

// Benutzerzeichnung
canvas.addEventListener("mousedown", (event) => {
    const rect = canvas.getBoundingClientRect();
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;
    const col = Math.floor(x / tileSize);
    const row = Math.floor(y / tileSize);
    if (row >= 0 && row < rows && col >= 0 && col < cols) {
        mapArray[row][col] = 1; // Setze das Tile auf Benutzerzeichnung
        drawMap();
    }
});

// Noise hinzufügen
document.getElementById("generateNoise").addEventListener("click", () => {
    for (let row = 0; row < rows; row++) {
        for (let col = 0; col < cols; col++) {
            if (mapArray[row][col] === 0) {
                mapArray[row][col] = perlinNoise(col, row);
            }
        }
    }
    drawMap();
});

// Karte leeren
document.getElementById("clearMap").addEventListener("click", () => {
    mapArray = Array.from({ length: rows }, () => Array(cols).fill(0));
    drawMap();
});

// Initiale Karte zeichnen
drawMap();
